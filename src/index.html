<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <title>POIN</title>
  <base href="/">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <script src="https://unpkg.com/carbon-components@latest/scripts/carbon-components.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/handtrackjs/dist/handtrack.min.js"> </script>
  <link rel="icon" type="image/x-icon" href="favicon.ico">
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
  <!-- <script src="./handtrack-miho.js"></script> -->
</head>

<body>
  <app-root></app-root>

  <video class="videobox canvasbox" autoplay="autoplay" id="myvideo"></video>
  <canvas id="canvas" class="border canvasbox"></canvas>
  <div id="mydiv" style="position:absolute; height: 100px; width: 100px; background-color: red;"></div>
  
  <script>
    var myDiv = document.getElementById('mydiv');
    const video = document.getElementById("myvideo");
    const canvas = document.getElementById("canvas");
    const context = canvas.getContext("2d");
    let updateNote = document.getElementById("updatenote");
    let isVideo = false;
    let model = null;

    const modelParams = {
      flipHorizontal: true, // flip e.g for video  
      maxNumBoxes: 20, // maximum number of boxes to detect
      iouThreshold: 0.5, // ioU threshold for non-max suppression
      scoreThreshold: 0.6, // confidence threshold for predictions.
    }

    window.onload = function () {
      toggleVideo();
    };


    function startVideo() {
      handTrack.startVideo(video).then(function (status) {
        if (status) {
          isVideo = true
          runDetection()
        }
      });
    }

    function toggleVideo() {
      if (!isVideo) {
        startVideo();
      } else {
        handTrack.stopVideo(video)
        isVideo = false;
      }
    }

    function runDetection() {
      model.detect(video).then(predictions => {
        if (predictions[0] != undefined) {
          console.log("Predictions: ", predictions[0].bbox[0]);
          myDiv.style.position = "absolute";
          myDiv.style.left = (predictions[0].bbox[0] * 3) + 'px';
          myDiv.style.top = (predictions[0].bbox[1] * 6) + 'px';

          if (predictions[0].bbox[0] >= 350) {
            window.location.replace(document.getElementById("test").innerHTML);
            console.log(document.getElementById("test").innerHTML);
          }
        }
        model.renderPredictions(predictions, canvas, context, video);
        if (isVideo) {
          requestAnimationFrame(runDetection);
        }

      });
    }

    // Load the model.
    handTrack.load(modelParams).then(lmodel => {
      model = lmodel
    });

  </script>
</body>

</html>
